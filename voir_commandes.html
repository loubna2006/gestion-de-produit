<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voir Commandes - SmartZone</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family:'Helvetica Neue', Arial, sans-serif; margin:0; padding:0; background:#f8f9fa; color:#333; }
#header { background:white; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:15px 0; position:sticky; top:0; z-index:1000; }
.logo { text-align:center; font-size:2rem; font-weight:300; color:#2c5530; margin:0; padding:10px 0; }
#navbar { display:flex; justify-content:center; list-style:none; padding:0; margin:0; gap:30px; }
#navbar a { text-decoration:none; color:#333; font-weight:400; transition: color 0.3s ease; }
#navbar a:hover { color:#2c5530; }
h2 { text-align:center; margin-top:40px; font-weight:300; font-size:2.2rem; color:#2c2c2c; }
.commande { border:1px solid #eaeaea; background:white; padding:15px; margin:20px auto; max-width:900px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.08); }
.commande h4 { color:#2c5530; margin-bottom:10px; }
.commande table { width:100%; border-collapse:collapse; margin-top:10px; }
.commande table th, .commande table td { padding:10px; border:1px solid #eaeaea; text-align:center; }
button { padding:8px 16px; border:none; border-radius:8px; cursor:pointer; margin-top:5px; font-weight:500; margin-right:5px; }
.valider-btn { background:#28a745; color:white; }
.valider-btn:hover { background:#218838; }
.supprimer-btn { background:#dc3545; color:white; }
.supprimer-btn:hover { background:#c82333; }
.validated { background:#6c757d; color:white; }
.validated:hover { background:#5a6268; }
</style>
</head>
<body>

<section id="header">
    <h1 class="logo">SmartZone</h1>
    <ul id="navbar">
        <li><a href="index.html">Accueil</a></li>
        <li><a href="boutique.html">Boutique</a></li>
        <li><a href="panier.html">Panier</a></li>
        <li><a href="voir_commandes.html">Les commandes</a></li>
    </ul>
</section>

<h2>Mes Commandes</h2>
<div id="liste-commandes"></div>

<script>
let commandes = JSON.parse(localStorage.getItem('commandes')) || [];
const liste = document.getElementById('liste-commandes');

function afficherCommandes(){
    liste.innerHTML = '';
    if(commandes.length === 0){
        liste.innerHTML = "<p style='text-align:center;'>Vous n'avez passé aucune commande pour le moment.</p>";
        return;
    }

    commandes.forEach((c,i)=>{
        const div = document.createElement('div');
        div.classList.add('commande');

        const client = c.client || {nom:'-', tel:'-', adresse:'-', notes:''};
        const valide = c.valide !== undefined ? c.valide : false;
        const statut = c.statut || 'En attente';

        let html = `<h4>Commande #${i+1} - ${c.date || '-'}</h4>`;
        html += `<p><strong>Client :</strong> ${client.nom} | ${client.tel} | ${client.adresse}</p>`;
        if(client.notes) html += `<p><strong>Notes :</strong> ${client.notes}</p>`;
        html += `<p><strong>Statut :</strong> ${statut} | <strong>Validée :</strong> ${valide ? 'Oui' : 'Non'}</p>`;

        html += `<table><thead><tr><th>Produit</th><th>Prix</th><th>Quantité</th><th>Sous-total</th></tr></thead><tbody>`;
        if(c.produits && c.produits.length > 0){
            c.produits.forEach(p=>{
                const sousTotal = p.prix * p.quantite;
                html += `<tr><td>${p.nom}</td><td>${p.prix} DH</td><td>${p.quantite}</td><td>${sousTotal} DH</td></tr>`;
            });
        }
        html += `</tbody></table>`;

        if(!valide){
            html += `<button class="valider-btn" data-index="${i}">Valider</button>`;
            html += `<button class="supprimer-btn" data-index="${i}">Supprimer</button>`;
        } else {
            html += `<button class="validated" disabled>Validée</button>`;
        }

        div.innerHTML = html;
        liste.appendChild(div);
    });
}

afficherCommandes();

// Événements boutons
document.addEventListener('click', e=>{
    if(e.target.classList.contains('valider-btn')){
        const index = e.target.dataset.index;
        commandes[index].valide = true;
        commandes[index].statut = "Validée par admin";
        localStorage.setItem('commandes', JSON.stringify(commandes));
        afficherCommandes();
    }
    if(e.target.classList.contains('supprimer-btn')){
        const index = e.target.dataset.index;
        if(confirm("Voulez-vous vraiment supprimer cette commande ?")){
            commandes.splice(index,1);
            localStorage.setItem('commandes', JSON.stringify(commandes));
            afficherCommandes();
        }
    }
});
</script>

</body>
</html>
